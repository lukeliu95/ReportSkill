---
name: planning-with-files
description: 使用Manus风格的持久化markdown文件进行规划、进度跟踪和知识存储,将工作流转变为文件驱动的方式。当开始复杂任务、多步骤项目、研究任务时使用,或当用户提到规划、组织工作、跟踪进度或需要结构化输出时使用。
---

# Planning with Files

像Manus一样工作:使用持久化markdown文件作为你的"磁盘上的工作内存"。

## 快速开始

在开始**任何复杂任务**之前:

1. **在工作目录创建 `task_plan.md`**
2. **定义阶段**,使用复选框标记
3. **每个阶段后更新** - 标记 [x] 并更改状态
4. **决策前先读取** - 在注意力窗口中刷新目标

## 三文件模式

对于每个非平凡任务,创建**三个文件**:

| 文件 | 用途 | 何时更新 |
|------|------|----------|
| `task_plan.md` | 跟踪阶段和进度 | 每个阶段完成后 |
| `notes.md` | 存储发现和研究内容 | 研究过程中 |
| `[deliverable].md` | 最终输出 | 完成时 |

## 核心工作流

```
循环1: 创建task_plan.md,包含目标和阶段
循环2: 研究 → 保存到notes.md → 更新task_plan.md
循环3: 读取notes.md → 创建交付物 → 更新task_plan.md
循环4: 交付最终输出
```

### 详细循环说明

**每次主要行动前:**
```bash
Read task_plan.md  # 在注意力窗口中刷新目标
```

**每个阶段后:**
```bash
Edit task_plan.md  # 标记 [x],更新状态
```

**存储信息时:**
```bash
Write notes.md     # 不要塞满上下文,存储到文件中
```

## task_plan.md 模板

对任何复杂任务**首先创建**这个文件:

```markdown
# Task Plan: [简短描述]

## Goal
[一句话描述最终状态]

## Phases
- [ ] Phase 1: 规划和设置
- [ ] Phase 2: 研究/收集信息
- [ ] Phase 3: 执行/构建
- [ ] Phase 4: 审查和交付

## Key Questions
1. [需要回答的问题]
2. [需要回答的问题]

## Decisions Made
- [决策]: [理由]

## Errors Encountered
- [错误]: [解决方案]

## Status
**Currently in Phase X** - [我现在正在做什么]
```

## notes.md 模板

用于研究和发现:

```markdown
# Notes: [主题]

## Sources

### Source 1: [名称]
- URL: [链接]
- Key points:
  - [发现]
  - [发现]

## Synthesized Findings

### [类别]
- [发现]
- [发现]
```

## 关键规则

### 1. 总是先创建计划
永远不要在没有 `task_plan.md` 的情况下开始复杂任务。这是不可协商的。

### 2. 决策前先读取
在任何重大决策前,读取计划文件。这将目标保持在你的注意力窗口中。

### 3. 行动后立即更新
完成任何阶段后,立即更新计划文件:
- 用 [x] 标记已完成的阶段
- 更新状态部分
- 记录遇到的任何错误

### 4. 存储而非塞满
大型输出存入文件,而非上下文。工作内存中只保留路径。

### 5. 记录所有错误
每个错误都记入"Errors Encountered"部分。这为未来任务构建知识。

## 何时使用此模式

**使用三文件模式用于:**
- 多步骤任务(3+步骤)
- 研究任务
- 构建/创建某物
- 跨越多个工具调用的任务
- 任何需要组织的事情

**跳过用于:**
- 简单问题
- 单文件编辑
- 快速查询

## 需要避免的反模式

| 不要做 | 应该做 |
|--------|--------|
| 使用TodoWrite进行持久化 | 创建 `task_plan.md` 文件 |
| 只陈述一次目标就忘记 | 每次决策前重新读取计划 |
| 隐藏错误并重试 | 将错误记录到计划文件 |
| 将所有内容塞进上下文 | 将大型内容存储在文件中 |
| 立即开始执行 | **首先**创建计划文件 |

## 高级模式

参见 [reference.md](references/reference.md) 了解:
- 注意力操纵技术
- 错误恢复模式
- 来自Manus的上下文优化

参见 [examples.md](references/examples.md) 了解:
- 真实任务示例
- 复杂工作流模式

## Manus的6大原则

### 1. 文件系统作为外部内存
> "Markdown是我在磁盘上的'工作内存'。"

将文件系统视为无限内存:
- 将大型内容存储在文件中
- 上下文中只保留路径
- Agent可以在需要时"查找"信息

### 2. 通过重复操纵注意力
在每次决策前重新读取 `task_plan.md`,使目标出现在注意力窗口中。

### 3. 保留失败痕迹
**每个错误都记入计划文件**,而非隐藏和静默重试。

### 4. 避免少样本过拟合
引入受控变化,不要盲目复制粘贴模式。

### 5. 稳定前缀用于缓存优化
- 将静态内容放在**前面**
- 仅追加上下文(永不修改历史)

### 6. 仅追加上下文
**永不**修改之前的消息。始终追加新信息。

## Agent循环

```
1. 分析 → 2. 思考 → 3. 选择工具 → 4. 执行 → 5. 观察 → 6. 迭代 → 7. 交付
```

### 循环中的文件操作:

| 操作 | 何时使用 |
|------|----------|
| `write` | 新文件或完全重写 |
| `append` | 增量添加部分 |
| `edit` | 更新特定部分(复选框、状态) |
| `read` | 决策前审查 |

## 关键引用

> "如果模型改进是涨潮,我们希望Manus是船,而不是卡在海底的桩。"

> "对于复杂任务,我将笔记、代码和发现保存到文件中,以便在工作时引用它们。"

> "我使用file.edit来更新计划中的复选框,而不是重写整个文件。"